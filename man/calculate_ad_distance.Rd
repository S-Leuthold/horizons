% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/library-ad.R
\name{calculate_ad_distance}
\alias{calculate_ad_distance}
\title{Calculate Applicability Domain Distance}
\usage{
calculate_ad_distance(new_matrix, ad_metadata)
}
\arguments{
\item{new_matrix}{Numeric matrix of preprocessed features for new samples
(m × p). Must have same column names and order as training matrix.}

\item{ad_metadata}{List from \code{compute_ad_metadata()} containing:
\itemize{
\item \code{centroid}: Training feature means
\item \code{cov_matrix}: Training covariance matrix
\item \code{ad_thresholds}: Distance thresholds for binning
}}
}
\value{
Numeric vector (length m) of Mahalanobis distances. Non-negative.
}
\description{
Computes Mahalanobis distance from new samples to training centroid using
stored covariance matrix. Larger distances indicate samples further from
training domain.
}
\details{
\subsection{Mahalanobis Distance}{

For a sample \strong{x} with training centroid \strong{μ} and covariance \strong{Σ}:

\deqn{D^2 = (x - \mu)^T \Sigma^{-1} (x - \mu)}

This metric:
\itemize{
\item Accounts for feature correlations (unlike Euclidean distance)
\item Normalized by variance (scale-invariant)
\item Follows χ² distribution under normality assumption
}
}

\subsection{Feature Space Matching}{

New samples must be preprocessed identically to training (same SNV, PCA,
etc.). Column names are checked to ensure alignment.
}
}
\examples{
\dontrun{
# During prediction
new_features <- bake(prepped_recipe, new_data) \%>\%
  select(starts_with("PC")) \%>\%
  as.matrix()

distances <- calculate_ad_distance(new_features, ad_metadata)
}

}
\keyword{internal}
