% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pipeline-parse-ids.R
\name{parse_ids}
\alias{parse_ids}
\title{Parse sample IDs and metadata from filenames}
\usage{
parse_ids(x, format = NULL, patterns = NULL, too_few = "keep_original")
}
\arguments{
\item{x}{A \code{horizons_data} object from \code{spectra()}.}

\item{format}{Character. Format string with \code{{tokens}}, e.g.,
\code{"{project}_{sampleid}_{fraction}"}. Mutually exclusive with \code{patterns}.}

\item{patterns}{Named character vector. Regex patterns where names become
columns and unnamed elements are separators. Mutually exclusive with \code{format}.}

\item{too_few}{Character. How to handle non-matching filenames:
\itemize{
\item \code{"keep_original"} (default): Keep original filename as \code{sample_id}, warn.
\item \code{"error"}: Abort with list of non-matching files.
\item \code{"na"}: Set \code{sample_id} to NA, warn.
}}
}
\value{
The input \code{horizons_data} object with:
\itemize{
\item \code{sample_id} updated from the \code{sampleid} token (if present)
\item New metadata columns added to \code{data$analysis}
\item \code{data$role_map} updated with new columns (role: meta)
\item Provenance recorded in \code{provenance$parse_ids}
}
}
\description{
Extracts structured metadata from OPUS filenames and updates \code{sample_id} accordingly.
This function is designed for OPUS file workflows where instrument-generated filenames
encode project, sample ID, fraction, replicate, or position information.
}
\details{
\strong{Note:} This function is intended for OPUS file workflows. For CSV or tibble data,
sample IDs and metadata are typically already in separate columns and do not require
parsing. A warning is issued if \code{parse_ids()} is called on non-OPUS data.

The function supports two modes:

\strong{Format string mode} (\code{format} parameter):
Curly brackets denote tokens that become columns. Everything else is a literal
separator.

\if{html}{\out{<div class="sourceCode">}}\preformatted{format = "\{project\}_\{sampleid\}_\{fraction\}"
# Parses "PROJ-A_S100-1_GroundBulk" into:
#   project = "PROJ-A", sampleid = "S100-1", fraction = "GroundBulk"
}\if{html}{\out{</div>}}

\strong{Regex patterns mode} (\code{patterns} parameter):
Named patterns become columns; unnamed patterns are separators.

\if{html}{\out{<div class="sourceCode">}}\preformatted{patterns = c(project = "[^_]+", "_", sampleid = "S\\\\d+-\\\\d+", "_.*")
}\if{html}{\out{</div>}}

The special token \code{sampleid} (case-insensitive) overwrites the \code{sample_id}
column. All other tokens create new metadata columns.
}
\examples{
\dontrun{
# Basic format string
hd |> parse_ids(format = "{project}_{sampleid}_{fraction}")

# Mixed delimiters
hd |> parse_ids(format = "{project}-{sampleid}.{fraction}")

# Regex for complex cases
hd |> parse_ids(patterns = c(
  project = "PROJ-[A-Z]",
  "_",
  sampleid = "S\\\\d+-\\\\d+"
))
}

}
