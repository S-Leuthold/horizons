% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pipeline-validate.R
\name{validate}
\alias{validate}
\title{Pipeline: Validate Data for Modeling}
\usage{
validate(
  x,
  remove_outliers = FALSE,
  spectral_method = "mahalanobis",
  spectral_threshold = 0.975,
  response_method = "iqr",
  response_threshold = 1.5
)
}
\arguments{
\item{x}{\link{horizons_data}. Configured object (must have \code{config$configs}).}

\item{remove_outliers}{\link{logical(1) or character(1)}. \code{FALSE} to detect
only (default), \code{TRUE} to remove all flagged outliers, \code{"spectral"} or
\code{"response"} for selective removal.}

\item{spectral_method}{\link{character(1)}. Spectral outlier detection method.
Currently only \code{"mahalanobis"}. Default: \code{"mahalanobis"}.}

\item{spectral_threshold}{\link{numeric(1)}. Chi-squared quantile for
Mahalanobis distance cutoff. Default: \code{0.975}.}

\item{response_method}{\link{character(1)}. Response outlier detection method.
Currently only \code{"iqr"}. Default: \code{"iqr"}.}

\item{response_threshold}{\link{numeric(1)}. IQR multiplier for Tukey fences.
Default: \code{1.5}.}
}
\value{
\link{horizons_data}. Same object with \code{validation} section populated:
\itemize{
\item \code{validation$passed}: \code{TRUE} if no ERROR checks failed
\item \code{validation$checks}: tibble of check results
\item \code{validation$outliers}: detected and optionally removed outlier IDs
\item \code{validation$timestamp}: when validation ran
}
}
\description{
Runs pre-flight checks on a configured \code{horizons_data} object before
expensive model evaluation. Checks sample sufficiency, outcome health,
predictor quality, and detects spectral and response outliers.
}
\details{
\code{validate()} is the gate between \code{configure()} and \code{evaluate()}. Detection
is mandatory; outlier removal is opt-in. The function populates the
\code{validation} section of the object and sets \code{validation$passed} based on
whether any ERROR-severity checks failed.

\strong{Severity levels:}
\itemize{
\item \strong{ERROR}: Blocks modeling. \code{validation$passed} set to \code{FALSE}.
\item \strong{WARNING}: Non-blocking but noteworthy. Does not affect \code{passed}.
\item \strong{INFO}: Descriptive/detection results. Does not affect \code{passed}.
}

\strong{Outlier detection:}

Spectral outliers are detected via Mahalanobis distance on PCA scores
of the raw (unpreprocessed) spectral matrix, scaled to unit variance per
wavenumber. Response outliers use IQR-based Tukey fences on the outcome
variable.

\strong{Idempotency:}

Running \code{validate()} multiple times overwrites previous results. If
outliers were removed in a prior call, those rows are gone; re-validation
operates on the reduced dataset.
}
\examples{
\dontrun{
x |>
  configure(models = c("rf", "cubist")) |>
  validate() |>
  evaluate()

# Remove outliers
x |> validate(remove_outliers = TRUE)

# Remove only spectral outliers
x |> validate(remove_outliers = "spectral")
}

}
