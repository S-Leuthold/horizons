% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/library-train.R
\name{prepare_cluster_splits}
\alias{prepare_cluster_splits}
\title{Library Model Training and Optimization}
\usage{
prepare_cluster_splits(
  cluster_data,
  property,
  ilr_coordinate = NULL,
  train_prop = 0.8,
  seed = 123
)
}
\arguments{
\item{cluster_data}{Tibble with cluster samples (spectra + property measurements)}

\item{property}{Character. Property name (e.g., "clay")}

\item{ilr_coordinate}{Integer. For texture properties, which ILR coordinate to use as Response (1 or 2).
NULL for non-texture properties. When texture property requested, function will:
\itemize{
\item Apply ILR transformation to all 3 texture components
\item Use ilr_coordinate to select which coordinate becomes Response column
\item Both coordinates will be present in data for potential dual training
}}

\item{train_prop}{Numeric (0-1). Proportion for training pool. Default: 0.8}

\item{seed}{Integer. Random seed for reproducibility. Default: 123}
}
\value{
List with:
\describe{
\item{training_pool}{Tibble, 80\% of samples for training and optimization}
\item{external_test}{Tibble, 20\% of samples for UQ calibration (never used in training)}
\item{n_train}{Integer, number of training samples}
\item{n_test}{Integer, number of test samples}
\item{ilr_coordinate}{Integer or NULL, tracks which ILR coordinate if texture}
}
}
\description{
Functions for training models on clustered library data with automatic config
selection and hyperparameter optimization. Implements two-stage training:
Stage 1 - Fast config selection across candidates, Stage 2 - Deep hyperparameter
tuning of winner.

Creates 80/20 train/test split of cluster data, preserving the external test
set for UQ calibration. The 80\% training pool is used for both config optimization
and final model training.
}
\details{
This module bridges library data/clustering infrastructure with tidymodels
training pipelines. Key features:
\itemize{
\item Reuses existing build_recipe() and define_model_specifications()
\item Two-stage optimization (config then hyperparameters)
\item Composite scoring (RPD, CCC, RÂ², RMSE)
\item Memory-optimized (butcher, rm/gc pattern)
\item Preserves external test set for UQ calibration
}

\strong{Split Strategy:}
\itemize{
\item 80\% training pool: Used for config selection AND final model training
\item 20\% external test: NEVER touched during training, preserved for:
\itemize{
\item Conformal calibration (Phase 3)
\item Final performance validation
\item Coverage assessment
}
}

Split is stratified by property value quantiles to ensure both sets
represent the full range of property values.
}
\keyword{Cluster}
\keyword{Data}
\keyword{Prepare}
\keyword{Splits}
\keyword{Training}
\keyword{for}
\keyword{internal}
