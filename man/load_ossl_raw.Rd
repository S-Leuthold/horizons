% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/library-data.R
\name{load_ossl_raw}
\alias{load_ossl_raw}
\title{Load Raw OSSL Data for Property}
\usage{
load_ossl_raw(property, cache_dir = NULL, max_samples = NULL, verbose = TRUE)
}
\arguments{
\item{property}{Character. Property name from LIBRARY_PROPERTIES.
Use \code{LIBRARY_PROPERTIES} to see supported properties.}

\item{cache_dir}{Character. Cache directory path. Default: NULL (uses \code{tools::R_user_dir("horizons", "cache")}).
Specify custom path for testing or non-standard installations.}

\item{max_samples}{Integer. Maximum samples to return. Default: NULL (all available).
Used primarily for testing - limits result size for faster iteration.
Production use should omit this parameter for full library coverage.}

\item{verbose}{Logical. Print tree-style progress messages? Default: TRUE.
Set FALSE for batch operations or when used programmatically.}
}
\value{
A tibble with columns:
\describe{
\item{sample_id}{OSSL sample identifier (UUID)}
\item{<property_column>}{Property measurement with OSSL name (e.g., "clay.tot_usda.a334_w.pct")}
\item{X600, X602, ...}{MIR spectral absorbance at each wavenumber (cm⁻¹)}
}

Returns NULL if loading fails (check logs for details).
}
\description{
Downloads (if needed) and loads OSSL lab measurements and MIR spectra from cache,
joins them, and extracts data for the requested property. Raw OSSL files are cached
globally in the user directory and reused across properties for efficiency.
}
\details{
\strong{Workflow:}
\enumerate{
\item Check cache for OSSL lab data (ossl_lab_data.qs)
\item If not cached, download from soilspec4gg-public bucket and cache
\item Same process for MIR spectra (ossl_mir_raw.qs)
\item Extract property measurements from lab data (remove NA values)
\item Inner join with MIR spectra on sample_id
\item Rename MIR columns from scan_mir.600_abs to X600 format
\item Optional: subsample for testing speed
\item Clean up intermediate objects (memory discipline)
}

\strong{Caching Strategy:}
Raw OSSL files (~200MB each) are downloaded once and cached in:
\code{tools::R_user_dir("horizons", "cache")}

Subsequent calls for ANY property reuse these cached files (fast).

\strong{Data Sources:}
\itemize{
\item Lab data: https://storage.googleapis.com/soilspec4gg-public/ossl_soillab_L1_v1.2.qs
\item MIR spectra: https://storage.googleapis.com/soilspec4gg-public/ossl_mir_L0_v1.2.qs
}
}
\section{Error Handling}{

Uses \code{safely_execute()} + \code{handle_results()} pattern:
\itemize{
\item Download failures return NULL with hints (check connection, server status)
\item Cache read failures return NULL with hints (try deleting corrupt cache)
\item Missing property columns abort with informative message
}
}

\section{Memory Management}{

After joining, removes large intermediate objects:
\itemize{
\item rm(lab_data, mir_data, lab_subset)
\item gc() to reclaim memory
Overhead: ~50-100MB per property
}
}

\examples{
\dontrun{
# Load clay data
clay <- horizons:::load_ossl_raw("clay")

# With custom cache (for testing)
oc <- horizons:::load_ossl_raw(
  property = "oc",
  cache_dir = tempdir(),
  max_samples = 500,
  verbose = TRUE
)
}

}
\seealso{
\code{\link[=get_library_property_mapping]{get_library_property_mapping()}}, \code{\link[=preprocess_library_spectra]{preprocess_library_spectra()}}
}
\keyword{internal}
