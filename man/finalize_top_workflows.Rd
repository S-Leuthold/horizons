% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/evaluation-finalize.R
\name{finalize_top_workflows}
\alias{finalize_top_workflows}
\title{Finalize Top Models with Bayesian Optimization}
\usage{
finalize_top_workflows(
  evaluation_results,
  input_data,
  covariate_data = NULL,
  variable,
  n_best = 10,
  metric = "rrmse",
  output_dir = NULL,
  train_prop = 0.8,
  bayesian_iter = 15,
  cv_folds = 10,
  seed = 307,
  allow_par = FALSE,
  n_workers = NULL,
  verbose = TRUE
)
}
\arguments{
\item{evaluation_results}{A tibble from \code{evaluate_models_local()} or \code{evaluate_models_hpc()}
containing columns: \code{status}, \code{workflow_id}, \code{best_params}, and the specified metric}

\item{input_data}{Data frame with predictor features and response variable}

\item{covariate_data}{Optional data frame with additional covariate predictors. Default: \code{NULL}}

\item{variable}{Character string. Name of the response variable column in \code{input_data}}

\item{n_best}{Integer. Number of top models to finalize. Default: \code{10}}

\item{metric}{Character string. Metric for selecting top models:
\itemize{
\item \code{"rrmse"}: Relative RMSE (default)
\item \code{"rmse"}: Root mean squared error
\item \code{"ccc"}: Concordance correlation coefficient
\item \code{"rsq"}: R-squared
\item \code{"rpd"}: Ratio of performance to deviation
\item \code{"mae"}: Mean absolute error
}}

\item{output_dir}{Character string or \code{NULL}. Directory to save finalized workflows.
If \code{NULL}, uses a temporary directory. Default: \code{NULL}}

\item{train_prop}{Numeric between 0 and 1. Proportion of data for training. Default: \code{0.8}}

\item{bayesian_iter}{Integer. Number of Bayesian optimization iterations. Default: \code{15}}

\item{cv_folds}{Integer. Number of cross-validation folds for generating predictions. Default: \code{10}}

\item{seed}{Integer. Random seed for reproducibility. Default: \code{0307}}

\item{allow_par}{Logical. Enable parallel processing for cross-validation. Default: \code{FALSE}}

\item{verbose}{Logical. Print detailed progress information. Default: \code{TRUE}}

\item{n_cores}{Integer or \code{NULL}. Number of cores for parallel processing.
If \code{NULL} and \code{allow_par = TRUE}, uses available cores minus 1. Default: \code{NULL}}
}
\value{
A tibble containing finalized model information with columns:
\itemize{
\item \code{wflow_id}: Model identifier
\item \code{workflow}: Finalized workflow object
\item \code{cv_predictions}: Cross-validation predictions for stacking
\item \code{metrics}: Performance metrics from CV
\item \code{best_params}: Final optimized hyperparameters
\item \code{optimization_time}: Time taken for optimization (minutes)
\item \code{path}: Path to saved workflow file
\item Original columns from input (model type, preprocessing, etc.)
}
}
\description{
Refines the top-performing models from evaluation results using Bayesian optimization
with warm-start from initial grid search results. Generates cross-validation predictions
needed for ensemble stacking.

The function:
\enumerate{
\item Selects top N models based on the specified metric
\item Creates parameter search spaces around best parameters
\item Performs Bayesian optimization to refine hyperparameters
\item Generates CV predictions for ensemble stacking
\item Saves finalized workflows and results
}
}
\examples{
\dontrun{
# Finalize top 5 models based on RMSE
finalized <- finalize_top_workflows(
  evaluation_results = model_results,
  input_data = spectral_data,
  variable = "SOC",
  n_best = 5,
  metric = "rmse",
  bayesian_iter = 20,
  verbose = TRUE
)

# Access finalized workflows
finalized$workflow[[1]]  # First workflow
finalized$cv_predictions[[1]]  # CV predictions for stacking
}

}
