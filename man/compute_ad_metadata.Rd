% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/library-ad.R
\name{compute_ad_metadata}
\alias{compute_ad_metadata}
\title{Library Prediction Applicability Domain (AD) Functions}
\usage{
compute_ad_metadata(feature_matrix)
}
\arguments{
\item{feature_matrix}{Numeric matrix of preprocessed features (n × p).
Must have column names. Rows are samples, columns are features (e.g., PCs).}
}
\value{
List with components:
\describe{
\item{centroid}{Numeric vector (length p): feature means}
\item{cov_matrix}{Numeric matrix (p × p): shrinkage covariance}
\item{ad_thresholds}{Numeric vector (length 4): Q1, Q2, Q3, p99 thresholds}
}
}
\description{
Functions for computing and applying applicability domain metrics in
library-based prediction. Uses Mahalanobis distance in model feature space
to assess whether new samples are within the training domain.

Computes AD metadata from training feature matrix: centroid, covariance
matrix (with Ledoit-Wolf shrinkage), and distance thresholds for binning.
}
\details{
\subsection{Covariance Estimation}{

Uses Ledoit-Wolf shrinkage via \code{corpcor::cov.shrink()} to handle high-
dimensional settings (p > n) and improve stability. Shrinkage target is
identity matrix scaled by average variance.
}

\subsection{Distance Thresholds}{

Computes Mahalanobis distances for all training samples, then extracts:
\itemize{
\item Q1: 25th percentile
\item Q2: 50th percentile (median)
\item Q3: 75th percentile
\item p99: 99th percentile (OOD cutoff)
}

Samples beyond p99 are considered out-of-domain (OOD).
}
}
\examples{
\dontrun{
# After preprocessing (e.g., PCA)
feature_matrix <- bake(prepped_recipe, training_data) \%>\%
  select(starts_with("PC")) \%>\%
  as.matrix()

ad_metadata <- compute_ad_metadata(feature_matrix)
}

}
\keyword{Applicability}
\keyword{Compute}
\keyword{Domain}
\keyword{Metadata}
\keyword{internal}
