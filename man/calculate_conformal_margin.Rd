% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/library-uq.R
\name{calculate_conformal_margin}
\alias{calculate_conformal_margin}
\title{Calculate Conformal Calibration Margin with CV+}
\usage{
calculate_conformal_margin(
  point_cv_preds,
  quantile_cv_preds,
  alpha = 0.1,
  verbose = FALSE
)
}
\arguments{
\item{point_cv_preds}{Tibble with OOF point predictions.
Must have columns: \code{.row}, \code{Response}, \code{.pred}}

\item{quantile_cv_preds}{Tibble with OOF quantile predictions.
Must have columns: \code{.row}, \code{.pred_lower}, \code{.pred_upper}}

\item{alpha}{Numeric. Miscoverage rate (default: 0.10 for 90\% intervals).}

\item{verbose}{Logical. Print diagnostic information?}
}
\value{
Numeric scalar: the conformal calibration margin c_alpha.
}
\description{
Computes the conformal calibration margin (c_alpha) using matched out-of-fold
predictions from both point and quantile models. This is the PROPER CV+
approach that avoids optimistic bias from in-sample quantile predictions.
}
\details{
\subsection{CV+ Conformal Calibration Approach}{

This function implements PROPER conformal calibration with out-of-fold
predictions from BOTH models:
\enumerate{
\item Match OOF point predictions with OOF quantile predictions by \code{.row}
\item Construct intervals: point_OOF + quantile_residuals_OOF
\item Compute nonconformity scores on all training samples
\item Find c_alpha as (1-alpha) quantile of scores
}

\strong{Why This Works:}
\itemize{
\item Point predictions are OOF (unbiased) ✓
\item Quantile predictions are OOF (unbiased) ✓
\item Both use SAME CV folds (aligned by sample) ✓
\item Result: Statistically valid coverage guarantee ✓
}

\strong{Previous Issue (FIXED in M3.3):}
\itemize{
\item Old version used in-sample quantile predictions (optimistic bias)
\item New version uses OOF quantiles from shared CV folds
\item Fixes the same issue we fixed for residuals in M3.1!
}
}
}
\keyword{internal}
