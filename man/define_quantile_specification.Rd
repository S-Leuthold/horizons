% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/models-specifications.R
\name{define_quantile_specification}
\alias{define_quantile_specification}
\title{Define Quantile Regression Specification}
\usage{
define_quantile_specification()
}
\value{
A \code{parsnip} model specification object configured for quantile regression.
The returned specification has tunable hyperparameters (\code{mtry}, \code{min_n}) and
is ready for use in \code{workflow()} objects. Trains a single model that can
predict multiple quantiles at prediction time.
}
\description{
Creates a ranger model specification configured for quantile regression.
Used exclusively for uncertainty quantification in library prediction mode.
This function supports the decoupled UQ architecture where point predictions
come from the best-performing model (any of the 9 model types), while
uncertainty quantification always uses ranger quantile regression.
}
\details{
\subsection{How Ranger Quantile Regression Works}{

Unlike some quantile regression methods, ranger trains a SINGLE model with
\code{quantreg = TRUE}, then allows you to extract ANY quantile at prediction time:

\if{html}{\out{<div class="sourceCode r">}}\preformatted{# Training: One model
quantile_model <- train(define_quantile_specification())

# Prediction: Get multiple quantiles from same model
predict(quantile_model, new_data,
        type = "quantiles",
        quantiles = c(0.05, 0.95))
}\if{html}{\out{</div>}}

This is more efficient than training separate models for each quantile.
}

\subsection{Why Ranger for Quantile Regression?}{

Ranger is selected for all quantile models because it:
\itemize{
\item Fits multiple quantiles jointly from one model (efficient!)
\item Reduces crossing issues (q05 > q95) since quantiles come from same forest
\item Handles high-dimensional spectral data (1000+ features) efficiently
\item Provides stable quantile estimates via conditional inference trees
\item Has proven performance in soil spectroscopy literature
}
}

\subsection{Decoupled UQ Architecture}{

The horizons UQ system separates point prediction from uncertainty estimation:
\enumerate{
\item \strong{Point prediction}: Use winning model from config optimization
(could be cubist, PLSR, xgboost, etc.)
\item \strong{Quantile model}: Always use ranger (this function) - ONE model
\item \strong{Conformal calibration}: Applied to ranger quantiles for coverage guarantee
}

This decoupling allows:
\itemize{
\item UQ support for ALL 9 model types (not just those with native quantile support)
\item Consistent UQ behavior across different winning point models
\item Flexibility to swap quantile model implementation in future versions
}
}

\subsection{Texture Properties}{

For texture properties (sand, silt, clay), quantile models are trained on
ILR-transformed coordinates (ilr_1, ilr_2), requiring 4 models per cluster:
\itemize{
\item ilr_1: point model + quantile model
\item ilr_2: point model + quantile model
}

Total: 4 models per cluster for texture (not 6!)
}

\subsection{Belt-and-Suspenders Protection}{

Even if ranger's quantiles are imperfect, the conformal calibration layer
ensures 90\% coverage by computing a calibration margin (c_alpha) on held-out
data. Final intervals: \verb{[q05 - c_alpha, q95 + c_alpha]}
}
}
\examples{
\dontrun{
# Create quantile specification (gets both q05 and q95 at prediction)
spec_quantile <- define_quantile_specification()

# Use in workflow
wf <- workflows::workflow() \%>\%
  workflows::add_model(spec_quantile) \%>\%
  workflows::add_recipe(my_recipe)

# Fit
fitted_wf <- fit(wf, data = training_data)

# Predict quantiles
preds <- predict(fitted_wf, new_data = test_data,
                 type = "quantiles",
                 quantiles = c(0.05, 0.95))
}

}
\seealso{
\code{\link[=define_model_specifications]{define_model_specifications()}} for point prediction models,
\code{\link[parsnip:rand_forest]{parsnip::rand_forest()}},
\code{\link[ranger:ranger]{ranger::ranger()}} documentation for \code{quantreg} parameter
}
\keyword{internal}
