% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pipeline-add-response.R
\name{add_response}
\alias{add_response}
\title{Pipeline: Join Response Data}
\usage{
add_response(x, source, variable, by = "sample_id")
}
\arguments{
\item{x}{\link{horizons_data}. Object from pipeline (post-\code{average()}, unique
\code{sample_id} required).}

\item{source}{\link{tibble, data.frame, or character path}. Response data source.
If a path, read via \code{readr::read_csv()}.}

\item{variable}{\link{character vector}. Column name(s) in the source to join as
response variables. Required — no default. Must be numeric columns.}

\item{by}{\link{character}. Join key. Default \code{"sample_id"}. Use a named vector
for mismatched column names: \code{c("sample_id" = "Lab_ID")} where the name
is the horizons-side column and the value is the source-side column.}
}
\value{
A modified \code{horizons_data} object with:
\itemize{
\item Response columns added to \code{data$analysis}
\item New entries in \code{data$role_map} with \code{role = "response"}
\item Updated \code{data$n_responses} count
\item Provenance record appended to \code{provenance$add_response}
}
}
\description{
Joins lab-measured response data to a \code{horizons_data} object. This is the
bridge between spectral preprocessing and modeling — everything downstream
(\code{configure()}, \code{evaluate()}, etc.) requires response data.
}
\details{
\code{add_response()} performs a left join between the horizons analysis tibble
and a source of lab-measured data. Only columns named in \code{variable} are
joined; all other source columns are ignored.

\strong{Source types:}
\itemize{
\item \strong{tibble/data.frame} (canonical): Joined directly. User controls all
preprocessing.
\item \strong{character path} (convenience): Read via \code{readr::read_csv()}, then
joined. CSV only — for other formats, read the data yourself and pass
the tibble.
}

\strong{Join behavior:}

Left-join semantics matching \code{dplyr::left_join()} conventions. Strict exact
matching — no case-folding or fuzzy matching. When match quality is poor,
diagnostic messages detect common patterns (case mismatch, whitespace,
prefix/suffix) and suggest fixes.

\strong{Duplicate detection:}

Aborts if duplicates exist in either the source join key (would multiply
spectral rows) or the horizons join key (indicates replicates haven't been
averaged — suggests \code{average()} first).

\strong{Repeated calls:}

Can be called multiple times to join variables from different sources.
Aborts if a variable name already exists in the analysis tibble.

Joined variables receive \code{role = "response"} in the role map. Use
\code{configure()} to promote one response to \code{role = "outcome"} for modeling.
}
\examples{
\dontrun{
# Tibble source (canonical)
lab <- readr::read_csv("lab_results.csv")
hd |> add_response(lab, variable = c("SOC", "POM_C"), by = "sample_id")

# Path source (convenience)
hd |> add_response("lab_results.csv", variable = "SOC")

# Named join key (different column names)
hd |> add_response(lab, variable = "SOC", by = c("sample_id" = "Lab_ID"))

# Multiple sources (separate calls)
hd |>
  add_response(lab_carbon, variable = c("SOC", "POM_C")) |>
  add_response(lab_ph, variable = "pH")
}

}
