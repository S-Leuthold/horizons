% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/covariates-soil.R
\name{predict_soil_covariates}
\alias{predict_soil_covariates}
\title{Predict Soil Covariates Using Clustered Local Models (OSSL-Centric PCA)}
\usage{
predict_soil_covariates(
  input_data,
  covariates,
  n_similar = NULL,
  prop = 0.85,
  variance_threshold = 0.985,
  coverage = 0.8,
  max_clusters = 10,
  bayesian_iter = 10,
  allow_par = FALSE,
  n_workers = NULL,
  refresh = FALSE,
  verbose = TRUE,
  return_models = FALSE,
  derivative_order = 1,
  clustering_method = "kmeans",
  use_mahalanobis = FALSE,
  distance_percentile = 0.6
)
}
\arguments{
\item{input_data}{Tibble with MIR spectral data and Sample_ID column}

\item{covariates}{Character vector of soil properties to predict}

\item{n_similar}{Deprecated. Ignored in v0.9.0+. V2 uses all available OSSL samples.}

\item{prop}{Numeric. Proportion for training set (default: 0.85)}

\item{variance_threshold}{Numeric. PCA variance to capture (default: 0.985)}

\item{coverage}{Numeric. Proportion of OSSL to keep per cluster (default: 0.8)}

\item{max_clusters}{Integer. Maximum clusters to test (default: 10)}

\item{bayesian_iter}{Integer. Bayesian optimization iterations (default: 10)}

\item{allow_par}{Logical. Enable parallel processing (default: FALSE)}

\item{n_workers}{Integer. Number of parallel workers (default: NULL)}

\item{refresh}{Logical. Force refresh of OSSL data (default: FALSE)}

\item{verbose}{Logical. Print progress messages (default: TRUE)}

\item{return_models}{Logical. Return fitted models in output? (default: FALSE)
Setting to FALSE saves ~90\% memory in return value by discarding models after
prediction. Predictions and validation metrics are still returned - only the
fitted workflow objects are discarded. Set TRUE if you need to inspect model
internals or make additional predictions without re-training.}

\item{derivative_order}{Integer. SG derivative order: 0 = smoothing only,
1 = 1st derivative, 2 = 2nd derivative (default: 0, EXPERIMENTAL)}

\item{clustering_method}{Character. "kmeans" or "ward" (default: "kmeans", EXPERIMENTAL)}

\item{use_mahalanobis}{Logical. Use Mahalanobis distance for OSSL selection
instead of Euclidean (default: TRUE, EXPERIMENTAL)}

\item{distance_percentile}{Numeric. Percentile threshold for OSSL inclusion
per cluster (0-1). Lower = more selective. (default: 0.6, EXPERIMENTAL)}
}
\value{
Named list with:
\itemize{
\item predictions: Tibble with Sample_ID and predicted covariate columns
\item validation_metrics: Tibble with accuracy metrics per cluster/covariate
\item local_models: Nested list of fitted models (cluster × covariate)
\item cluster_info: Clustering details
}
}
\description{
Predicts soil properties from MIR spectra using OSSL-centric clustering
and locally-trained Cubist models. Trains PCA on OSSL (global spectral space),
projects unknowns into that space, clusters unknowns, selects relevant
OSSL training data for each cluster, and trains specialized models.

Changed in v0.9.0: Now uses OSSL-centric PCA (trains PCA on 12K+ OSSL samples)
instead of unknown-centric PCA. Achieves 8-10\% R² improvement over previous
global approach. Defaults to 1st derivative preprocessing and Euclidean distance.
}
\section{Experimental Parameters (not for production)}{

}

