% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/library-uq.R
\name{repair_quantile_crossings}
\alias{repair_quantile_crossings}
\title{Repair Quantile Crossings}
\usage{
repair_quantile_crossings(
  predictions,
  lower_col = ".pred_lower",
  upper_col = ".pred_upper"
)
}
\arguments{
\item{predictions}{A tibble or data frame with quantile predictions.
Must contain at least two quantile columns.}

\item{lower_col}{Character string or integer specifying the lower quantile column.
Default: \code{".pred_lower"} or column 1 if not found.}

\item{upper_col}{Character string or integer specifying the upper quantile column.
Default: \code{".pred_upper"} or column 2 if not found.}
}
\value{
The input data frame with crossings repaired. Modifies columns in-place
to enforce \code{lower <= upper} for all rows.
}
\description{
Ensures monotonicity of quantile predictions by enforcing q_lower <= q_upper.
Crossings occur when the lower quantile prediction exceeds the upper quantile
prediction, which is theoretically impossible but can happen due to numerical
issues in finite-sample estimation.
}
\details{
\subsection{Repair Strategy}{

When a crossing is detected (lower > upper), the repair:
\enumerate{
\item Sets \code{lower = min(lower, upper)}
\item Sets \code{upper = max(lower, upper)}
}

This preserves the interval width while ensuring monotonicity.
}

\subsection{When Crossings Occur}{

Crossings are rare (<5\% of predictions typically) but can occur when:
\itemize{
\item Sample size is small
\item Extrapolating far from training distribution
\item Extreme quantiles requested (e.g., q01, q99)
}
}
}
\examples{
\dontrun{
# Predict quantiles
preds <- predict_quantiles(model, new_data)

# Repair any crossings
preds_repaired <- repair_quantile_crossings(preds)

# Verify monotonicity
stopifnot(all(preds_repaired$.pred_lower <= preds_repaired$.pred_upper))
}

}
\keyword{internal}
