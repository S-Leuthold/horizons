% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/library-ad.R
\name{assign_ad_bin}
\alias{assign_ad_bin}
\title{Assign Applicability Domain Bins}
\usage{
assign_ad_bin(distances, thresholds)
}
\arguments{
\item{distances}{Numeric vector of Mahalanobis distances from
\code{calculate_ad_distance()}.}

\item{thresholds}{Numeric vector (length 4) of distance cutoffs:
\link{Q1, Q2, Q3, p99}. From \code{ad_metadata$ad_thresholds}.}
}
\value{
Factor (length = length(distances)) with levels:
\code{"Q1"}, \code{"Q2"}, \code{"Q3"}, \code{"Q4"}, \code{"OOD"}.
}
\description{
Categorizes distances into quartile bins (Q1-Q4) plus out-of-domain (OOD).
Used for reporting and (optionally) distance-aware conformal calibration.
}
\details{
\subsection{Bin Definitions}{
\itemize{
\item \strong{Q1} (0-25th percentile): Very safe, deep within training domain
\item \strong{Q2} (25-50th): Safe
\item \strong{Q3} (50-75th): Moderate risk
\item \strong{Q4} (75-99th): Higher risk, edge of training domain
\item \strong{OOD} (>99th): Out-of-domain, high extrapolation risk
}

Predictions with OOD flag will abstain (return NA) in M4.3.
}

\subsection{Boundary Handling}{

Uses \code{right = FALSE} in \code{cut()} â†’ intervals are [a, b). Sample exactly
at threshold is assigned to lower bin (conservative).
}
}
\examples{
\dontrun{
distances <- calculate_ad_distance(new_features, ad_metadata)
bins <- assign_ad_bin(distances, ad_metadata$ad_thresholds)

table(bins)
# Q1  Q2  Q3  Q4 OOD
# 45  50  48  35   2
}

}
\keyword{internal}
