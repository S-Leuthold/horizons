% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/library-data.R
\name{perform_pca_on_library}
\alias{perform_pca_on_library}
\title{Perform PCA on Library Spectra}
\usage{
perform_pca_on_library(library_data, variance_threshold = 0.99, verbose = TRUE)
}
\arguments{
\item{library_data}{Tibble with preprocessed spectral columns (output from preprocess_library_spectra)}

\item{variance_threshold}{Numeric (0-1). Cumulative variance to retain. Default: 0.99 (99\%).
Lower values = fewer components = faster clustering, but may lose spectral information.}

\item{verbose}{Logical. Print tree-style progress? Default: TRUE}
}
\value{
List with:
\describe{
\item{pca_model}{FactoMineR::PCA object - use for projecting new samples}
\item{pca_scores}{Matrix of PCA scores (n_samples Ã— n_components)}
\item{n_components}{Integer, number of components retained to reach threshold}
\item{variance_explained}{Numeric, actual cumulative variance explained}
}

Returns NULL if PCA fails (insufficient variance, constant columns, etc.)
}
\description{
Applies Principal Component Analysis to preprocessed library spectra to create
the clustering space. Retains components explaining specified variance threshold
(default 99\%). This PCA model is used to project unknowns into the same space.
}
\details{
Uses \code{FactoMineR::PCA()} with automatic component selection based on cumulative variance.
The PCA is unscaled (scale = FALSE) because spectra are already SNV-normalized.

Typical results: 15-25 components for 99\% variance on full OSSL library.
}
\examples{
\dontrun{
preprocessed <- horizons:::preprocess_library_spectra(raw_data)
pca_result <- horizons:::perform_pca_on_library(preprocessed, variance_threshold = 0.99)
}

}
\seealso{
\code{\link[=preprocess_library_spectra]{preprocess_library_spectra()}}, \code{\link[=project_to_library_pca]{project_to_library_pca()}}
}
\keyword{internal}
